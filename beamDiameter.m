%
%Beam Diameter
%Feb 28 2019
%
close all;
clear all;
x= [
9.775
9.8
9.825
9.843
9.855
9.872
9.878
9.902
9.918
9.926
9.936
9.947
9.962
9.965
9.977
9.998
10.019
10.038
10.065
10.108
10.122
10.133
10.148
10.165
10.108
10.122
10.133
10.148
10.165
10.187
10.212
10.243
10.269
10.295
10.327
10.375
10.403
10.443
10.472
10.494
10.541
10.595
10.684];

p= [
10
14
20
25
31
38
40
53
63
67
75
83
96
100
111
130
162
190
233
312
337
360
393
429
312
337
360
393
429
473
526
587
639
683
733
792
816
840
855
866
880
890
895
    ];


xError = [
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346
0.002886751346];

pError=[
0.1
8.14
0.2
10.25
2.31
16.38
0.4
6.53
6.63
14.67
10.75
6.83
12.96
1
3.11
1.3
5.62
1.9
8.33
7.12
17.37
3.6
9.93
22.29
7.12
17.37
3.6
9.93
22.29
10.73
17.26
19.87
24.39
12.83
13.33
11.92
20.16
8.4
18.55
20.66
8.8
8.9
18.95
    ];

errorbar(x,p,pError,'.');
grid on;
title("x (mm) vs p (uW)");
xlabel("x(mm)");
ylabel("power (uW)");


%
%seems tough to fit. will fit derivative
%

deriv =[];
deriverror=[];

for i=2:length(x)
    deriv(i)=(p(i)-p(i-1))/(x(i)-x(i-1));
    deriverror(i)=sqrt(pError(i)^2 +xError(i)^2);
end

figure;

%finding the line that will intersect with the 1/e value of the derivative
y=[];
for i=1:length(deriv)
    y(i) = (1/2.7)*max(deriv);
end

%plot(deriv);
errorbar(x,deriv,deriverror,'.'); hold on;
plot(x, y);
grid on;
title("x (mm) vs delta P (uW)");
xlabel("x(mm)");
ylabel("power difference (uW)");

%now use cftool to fit this curve

