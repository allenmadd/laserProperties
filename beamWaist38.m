
%Beam Waist d= 38.05
%
close all;
clear all;

x=[11.500
11.450
11.400
11.350
11.300
11.250
11.200
11.150
11.100
11.050
11.000
10.950
10.900
10.850
10.800
10.765
10.750
10.700
10.671
10.660
10.650
10.640
10.630
10.620
10.500
10.580
10.560
10.550
10.530
10.510
10.490
10.470
10.450
10.430
10.400
10.370
10.350
10.330
10.300
10.280
10.250
10.230
10.225
10.200
10.180
10.115
10.100
10.050
10.000
9.990
9.985
9.900
9.850
9.800
9.750
9.700
9.650
9.600
9.550
9.500
9.450
9.400
9.350
9.300
9.250
9.200
9.150
9.100
];

xError = [0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
0.02886751346
    ];


p=[
    891
889
886
884
881
878
878
874
866
860
854
847
838
826
814
808
803
786
779
769
765
757
755
749
740
730
719
713
700
690
676
661
652
638
619
604
583
570
548
532
510
492
464
427
412
391
353
317
283
276
252
222
196
181
150
126
104
87
73
59
53
42
33
26
18
14
11
8
];


pError=[
   10.91
26.89
20.86
16.84
10.81
24.78
24.78
16.74
20.66
8.6
16.54
22.47
24.38
20.26
16.14
24.08
14.03
19.86
25.79
25.69
17.65
21.57
17.55
25.49
7.4
7.3
25.19
13.13
7
6.9
18.76
8.61
10.52
22.38
24.19
14.04
11.83
5.7
21.48
9.32
5.1
8.92
12.64
18.27
8.12
5.91
9.53
17.17
8.83
14.76
6.52
6.22
13.96
3.81
1.5
13.26
9.04
14.87
6.73
18.59
6.53
4.42
6.33
12.26
16.18
8.14
2.11
16.08 
];



errorbar(x,p,pError,'.');
%plot(x,p,'o');
grid on;
title("x (mm) vs p (uW) distance 38.05 cm");
xlabel("x(mm)");
ylabel("power (uW)");


%
%seems tough to fit. will fit derivative
%

deriv =[];

deriverror=[];

x2 = [];
for i=2:length(x)
    %calculate what deriv will be
    a = (p(i)-p(i-1))/(x(i)-x(i-1));
    if (a < 1050)
        if (a > 0)
           deriv(i)=a;
           deriverror(i)=sqrt(pError(i)^2 +xError(i)^2);
           x2(i) = x(i);
        end
    end
    %deriv(i)=(p(i)-p(i-1))/(x(i)-x(i-1));
    
end

figure;

%finding the line that will intersect with the 1/e value of the derivative
y=[];
for i=1:length(deriv)
    y(i) = (1/2.7)*max(deriv);
end

%plot(deriv);
errorbar(x2,deriv,deriverror,'.'); hold on;
%plot(x,deriv, 'o'); hold on;
plot(x2, y);
xlim([9,11.5]);

grid on;
title("x (mm) vs delta P (uW), distance 38.05 cm");
xlabel("x(mm)");
ylabel("power difference (uW)");

%now use cftool to fit this curve